import{u as A,d as V,r as l,b as $,e as v,j as e,aZ as q,n as u,I as o,S as x,D as K,w as Q,g as R,B as y}from"./index-D30dUQcz.js";import{F as U}from"./Table-Bp26llHA.js";import{p as g}from"./programs-CIsHGAay.js";import{d}from"./dayjs.min-1Tz-y8oh.js";import J from"./program-filter-DcXSJj_Y.js";import C from"./program-form-modal-D55Fnl37.js";import{useProgramModal as Y}from"./use-program-modal-D_EGQCvW.js";import{P as W}from"./index-DHdriWPD.js";import{C as X}from"./index-Cet01eV5.js";import{A as Z}from"./index-C2DPUj06.js";import"./index-BijjHoeW.js";import"./index-CrfLqG3m.js";import"./Pagination-Mf8JmUTt.js";import"./index-BMojJ2We.js";import"./index-CpcqnRPv.js";const w="delete";function ue(){const{t:i}=A(),f=V(),[n,c]=l.useState({}),[I,m]=l.useState(!1),[h,M]=l.useState(null),[j,p]=l.useState(""),{data:r,refetch:s,isLoading:b,isFetching:D}=$({queryKey:["programs",n],queryFn:()=>g.get(n),refetchOnWindowFocus:!1}),{modalProps:P,onCreate:S,onEdit:T}=Y(!1,()=>s()),{modalProps:z,onEdit:F}=Y(!0,()=>s()),k=v({mutationFn:t=>g.destroy(t),onSuccess(){s()}}),_=v({mutationFn:t=>g.update(t,{state:"published"}),onSuccess(){s()}});function E(t){c(t)}function N(){c({})}const B=t=>{k.mutate(t.id)},L=t=>{_.mutate(t.id)},O=[{title:i("app.fields.name"),dataIndex:"name",fixed:"left",render:(t,a)=>e.jsx("div",{children:a.name})},{title:i("app.fields.thumbnail"),dataIndex:"name",render:(t,a)=>a.thumbnail&&e.jsx("img",{width:50,height:50,src:`data:image/png;base64,${a.thumbnail}`,alt:"thumbnail"})},{title:i("app.fields.state"),dataIndex:"state",render:(t,a)=>e.jsx("div",{children:i(`app.programs.statuses.${a.state}`)})},{title:i("app.fields.description"),dataIndex:"description",width:300,render:(t,a)=>e.jsx(q,{copyable:!0,ellipsis:!0,children:a.description})},{title:i("app.fields.start"),dataIndex:"start",render:(t,a)=>e.jsx("div",{children:d(a.start).format("YYYY-MM-DD")})},{title:i("app.fields.end"),dataIndex:"end",render:(t,a)=>e.jsx("div",{children:d(a.end).format("YYYY-MM-DD")})},{title:i("app.fields.registration start"),dataIndex:"registrationStart",render:(t,a)=>e.jsx("div",{children:d(a.registrationStart).format("YYYY-MM-DD")})},{title:i("app.fields.registration end"),dataIndex:"registrationEnd",render:(t,a)=>e.jsx("div",{children:d(a.registrationEnd).format("YYYY-MM-DD")})},{title:i("common.action"),dataIndex:"operation",width:100,fixed:"right",render:(t,a)=>e.jsxs("div",{className:"flex w-full justify-end text-gray",children:[e.jsx(u,{onClick:()=>f(`/programs/builder/${a.id}`),children:e.jsx(o,{icon:"solar:magic-stick-3-bold-duotone",size:18})}),e.jsx(W,{title:i("common.confirm-launch"),okText:i("common.ok"),cancelText:i("common.cancel"),placement:"left",onConfirm:()=>L(a),children:e.jsx("button",{type:"button",children:e.jsx(o,{icon:"solar:rocket-2-broken",size:24,className:"text-success-light"})})}),e.jsx(u,{onClick:()=>F(a,i("app.fields.thumbnail")),children:e.jsx(o,{icon:"solar:camera-outline",size:18})}),e.jsx(u,{onClick:()=>T(a),children:e.jsx(o,{icon:"solar:pen-bold-duotone",size:18})}),e.jsx("button",{type:"button",onClick:()=>{M(a),m(!0)},children:e.jsx(o,{icon:"mingcute:delete-2-fill",size:18,className:"text-error"})})]})}];return e.jsxs(x,{direction:"vertical",size:"large",className:"w-full",children:[e.jsx(J,{formValue:n,okDisabled:b||D,onClear:N,onSearch:E}),e.jsx(K,{children:i("app.programs.grid-header")}),e.jsxs(X,{title:i("app.programs.grid-header"),extra:e.jsxs(x,{children:[e.jsx(y,{type:"default",onClick:()=>f("/programs/builder"),icon:e.jsx(o,{icon:"solar:magic-stick-3-bold-duotone"}),children:i("app.programs.builder.title")}),e.jsx(y,{type:"primary",onClick:()=>S(),children:i("common.create")})]}),children:[e.jsx(U,{rowKey:"id",size:"small",scroll:{x:"max-content"},columns:O,dataSource:r==null?void 0:r.items,loading:b||D,pagination:{pageSizeOptions:[10,30,50],current:n.page??1,showSizeChanger:!0,showQuickJumper:!0,total:r==null?void 0:r.total,onChange:(t,a)=>c({...n,page:t,pageSize:a})}}),e.jsx(C,{...P}),e.jsx(C,{...z}),e.jsx(Q,{title:i("common.confirm-deleting"),open:I,onOk:()=>{h&&B(h),m(!1),p("")},okButtonProps:{danger:!0,disabled:j!==w,loading:k.isPending},onCancel:()=>{m(!1),p("")},okText:i("common.delete"),cancelText:i("common.cancel"),children:e.jsxs(x,{direction:"vertical",className:"w-full",size:"middle",children:[e.jsx(Z,{message:i("app.programs.delete-warning"),type:"warning",showIcon:!0}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 font-medium",children:i("app.programs.delete-confirm-label")}),e.jsx(R,{placeholder:w,value:j,onChange:t=>p(t.target.value),onPaste:t=>t.preventDefault(),autoFocus:!0})]})]})})]})]})}export{ue as default};
