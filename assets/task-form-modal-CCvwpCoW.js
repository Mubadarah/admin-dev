import{F as t,r as u,b as o,j as e,p as a,w as B,g as c,i as N}from"./index-DuvEvaeK.js";import{d as w}from"./dayjs.min-lKQw1SsZ.js";import{a as Q}from"./levels-BFjr8BMX.js";import{l as G}from"./lessons-DW1TOBpR.js";import{a as H}from"./subjects-BjPhUBHv.js";import{p as J}from"./programs-DArSPDIF.js";import{S as r}from"./index-DCzfojox.js";import{D as U}from"./index-BL8MymNb.js";import{a as X}from"./index-DkFJ1ymV.js";import"./index-COxOKunJ.js";function re({title:v,show:q,formValue:n,okDisabled:F,onOk:k,onCancel:S}){var x,b,g,f,y,I;const[p]=t.useForm(),[h,C]=u.useState(void 0),[j,T]=u.useState(void 0);u.useEffect(()=>{p.setFieldsValue({...n})},[n,p]);const O=o({queryKey:["programs"],queryFn:()=>J.get(),refetchOnWindowFocus:!1}),P=o({queryKey:["levels",j],queryFn:()=>Q.get({programId:j}),refetchOnWindowFocus:!1}),W=o({queryKey:["subjects"],queryFn:()=>H.get({}),refetchOnWindowFocus:!1}),A=o({queryKey:["assignments"],queryFn:()=>N.get({}),refetchOnWindowFocus:!1}),K=o({queryKey:["lessons",h],queryFn:()=>G.get({subjectId:h}),refetchOnWindowFocus:!1}),d=(x=O.data)==null?void 0:x.items.map(({id:s,name:l})=>({value:s,label:e.jsx("span",{children:l})}));d==null||d.unshift({value:"",label:e.jsx("span",{children:""})});const R=(b=P.data)==null?void 0:b.items.map(({id:s,name:l})=>({value:s,label:e.jsx("span",{children:l})})),D=(g=A.data)==null?void 0:g.items.map(({id:s,title:l})=>({value:s,label:e.jsx("span",{children:l})})),m=(f=W.data)==null?void 0:f.items.map(({id:s,name:l})=>({value:s,label:e.jsx("span",{children:l})}));m==null||m.unshift({value:"",label:e.jsx("span",{children:""})});const E=(y=K.data)==null?void 0:y.items.map(({id:s,title:l})=>({value:s,label:e.jsx("span",{children:l})})),z=s=>{C(s)},L=s=>{T(s)},i=t.useWatch("type",p),M=[{value:"lesson",label:a("app.tasks.types.lesson")},{value:"assignment",label:a("app.tasks.types.assignment")},{value:"meeting",label:a("app.tasks.types.meeting")},{value:"wird",label:a("app.tasks.types.wird")}],$={getValueProps:s=>({value:s&&w(s)}),normalize:s=>s&&`${w(s).toISOString()}`};return e.jsxs(B,{forceRender:!0,title:v,open:q,okButtonProps:{autoFocus:!0,htmlType:"submit",disabled:F},okText:n.id===void 0?a("common.create"):a("common.edit"),cancelText:a("common.cancel"),onCancel:S,modalRender:s=>e.jsx(t,{form:p,initialValues:n,onFinish:l=>k(n.id,l),labelCol:{span:6},wrapperCol:{span:18},layout:"horizontal",children:s}),children:[!n.id&&e.jsx(t.Item,{label:a("app.fields.program"),name:"programId",children:e.jsx(r,{showSearch:!0,options:d,onChange:L})}),!n.id&&e.jsx(t.Item,{label:a("app.fields.level"),name:"levelId",rules:[{required:!0}],children:e.jsx(r,{showSearch:!0,options:R})}),e.jsx(t.Item,{label:a("app.fields.type"),name:"type",rules:[{required:!0}],children:e.jsx(r,{options:M})}),i==="lesson"&&e.jsx(t.Item,{label:a("app.fields.subject"),name:"subjectId",children:e.jsx(r,{showSearch:!0,options:m,onChange:z})}),i==="lesson"&&e.jsx(t.Item,{label:a("app.lessons.title"),name:"lessonIds",rules:[{required:!0}],children:e.jsx(r,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Please select",defaultValue:(I=n.lessons)==null?void 0:I.map(s=>s.id),options:E})}),i==="assignment"&&e.jsx(t.Item,{label:a("app.fields.assignment"),name:"assignmentId",rules:[{required:!0}],children:e.jsx(r,{showSearch:!0,options:D})}),i==="meeting"&&e.jsx(t.Item,{label:a("app.fields.meetingLink"),name:"meetingLink",rules:[{required:!0},{type:"url"}],children:e.jsx(c,{placeholder:"https://..."})}),i==="wird"&&e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{label:a("app.fields.wirdTitle"),name:"wirdTitle",rules:[{required:!0}],children:e.jsx(c,{})}),e.jsx(t.Item,{label:a("app.fields.wirdDetails"),name:"wirdDetails",children:e.jsx(c.TextArea,{})})]}),e.jsx(t.Item,{label:a("app.fields.date"),name:"date",...$,rules:[{required:!0}],children:e.jsx(U,{style:{width:"100%"}})}),e.jsx(t.Item,{label:a("app.fields.note"),name:"note",children:e.jsx(c.TextArea,{})}),e.jsx(t.Item,{label:null,name:"hasChatRoom",valuePropName:"checked",children:e.jsx(X,{children:a("app.fields.hasChatRoom")})})]})}export{re as default};
